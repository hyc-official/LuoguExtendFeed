(()=>{var p="color: #5EB95E;";function i(t,...e){console.log(`%c[lgef] ${t}`,p,...e)}function m(t){let e={};i("Find cache",t);let n=new Date,a=new Date,o=new Date().getTime();return n.setTime(parseInt(GM_getValue(`cache/time_${t}`,"0"),10)),a.setTime(parseInt(GM_getValue("cache/expired","0"),10)),n===0?(i("Cache miss"),e.status="miss"):o-n>3e5||n<a?(i("Cache expired"),e.status="expired"):(i("Cache hit"),e.status="hit",e.content=GM_getValue(`cache/content_${t}`)),e}function w(t,e){i("Set cache",t,"=>",e),GM_setValue(`cache/content_${t}`,e),GM_setValue(`cache/time_${t}`,new Date().getTime().toString())}function d(t,e,...n){let a=m(t);a.status==="hit"?e(JSON.parse(a.content),...n):(i("Request",t),GM_xmlhttpRequest({method:"GET",url:t,onload(o){i("Request",`success: HTTP ${o.status}, Content: `,o.responseText);let c={error:!1,status:o.status,content:o.responseText};o.status===200&&w(t,JSON.stringify(c)),e(c,...n)},onerror(){i("Request","failed")}}))}var I={dragon:"/rank/dragon",dragond:"/rank/dailyDragon",bell:"/rank/bePinged",at:"/rank/pingOthers"};function f(t,e,n,...a){i("Get API",t);let o=`https://api-lgf.imken.moe${I[t]}`;for(let c in e)o=o.replaceAll(`{${c}}`,e[c]);d(o,n,...a)}var l=[["","",""],["dragon","\u7287\u728730d\u9F99\u738B\u699C","\u6761"],["dragond","\u7287\u728724h\u9F99\u738B\u699C","\u6761"],["bell","\u7287\u728730d\u94C3\u94DB\u699C","\u4E2A"],["at","\u7287\u728730d\u827E\u7279\u699C","\u6B21"]];function v(t,e,n){let a='<div data-v-8b7f80ba=""><span data-v-8b7f80ba=""><span data-v-36d4a8df="" data-v-8b7f80ba="">%NAME%</span></span><span data-v-8b7f80ba=""><span data-v-36d4a8df="" data-v-8b7f80ba="" class="info-content">%INFO%</span></span></div>';i("Add row",l[n][0]);let o=0;for(let c=0;c<e.content.length;c++)if(`${e.content[c].uid}`==`${_feInstance.currentData.user.uid}`){o=c+1;break}t.innerHTML+=a.replace(/%NAME%/g,l[n][1]).replace(/%INFO%/g,o!==0?`#${o} (${e.content[o-1].count} ${l[n][2]})`:"\u672A\u4E0A\u699C")}function u(t={},e=0){let n=document.querySelectorAll(".info-rows")[0];n===void 0||n.lgef!==void 0&&n.lgef>=e||e<l.length&&(n.lgef=e,e>0&&v(n,JSON.parse(t.content),e),e<l.length-1&&f(l[e+1][0],{},u,e+1))}var r={status:!1,content:[]};function h(t={},e=0){let n=Math.ceil(_feInstance.currentUser.followingCount/20);e>0&&(r.content=r.content.concat(JSON.parse(t.content).users.result)),e<n&&d(`/api/user/followings?user=${_feInstance.currentUser.uid}&page=${e+1}`,h,e+1),e===n&&(r.content.push(_feInstance.currentUser),r.status=!0,s({},1))}var g=1;function $(){let t=document.querySelectorAll(".am-u-lg-3.am-u-md-4.lg-right")[0];if(t.lastChild.id!=="lgef-flwing-rank"){let e=document.createElement("div");e.className="lg-article",e.id="lgef-flwing-rank",e.innerHTML=`
        <h2>\u300C\u6211\u5173\u6CE8\u7684\u300D\u7287\u7287\u6392\u884C</h2>
        <p>
            \u9009\u62E9\u6392\u884C\u699C
            <select id="lgef-flwing-rank-type">
                <option disabled="disabled">\u8BF7\u9009\u62E9</option>
                <option value="dragon" selected>30d\u9F99\u738B\u699C</option>
                <option value="dragond">24h\u9F99\u738B\u699C</option>
                <option value="bell">30d\u94C3\u94DB\u699C</option>
                <option value="at">30d\u827E\u7279\u699C</option>
            </select>
        </p>
        <div id="lgef-flwing-rank-show">
            <center>\u52A0\u8F7D\u4E2D...</center>
        </div>
        `,t.appendChild(e),document.getElementById("lgef-flwing-rank-type").addEventListener("change",()=>{g=document.getElementById("lgef-flwing-rank-type").selectedIndex,document.getElementById("lgef-flwing-rank-show").innerHTML="<center>\u52A0\u8F7D\u4E2D...</center>",s()})}}function E(t){let e=`
    <div style="width: 100%; display: flex; margin-bottom: 1em;">
    <span style="color: #c8c8c8;">
        #%RANK%
    </span>
    <span style="height: 1em; margin-left: .3em;">
        <img src="//cdn.luogu.com.cn/upload/usericon/%UID%.png" style="height: 1.5em; border-radius: .75em;">
        <a href="/user/%UID%" class="lg-fg-%COLOR% lg-bold" target="_blank">
            %NAME%
        </a>
    </span>
    <span style="margin-left: auto;">
        %VALUE% %UNIT%
    </span>
    </div>`,n="";for(let a=0;a<t.length;a++)n+=e.replace(/%RANK%/g,a+1).replace(/%UID%/g,t[a][1].uid).replace(/%COLOR%/g,t[a][1].color.toLowerCase()).replace(/%NAME%/g,t[a][1].name).replace(/%VALUE%/g,t[a][2]).replace(/%UNIT%/g,l[g][2]);n===""&&(n="<p><center>\u65E0\u4EBA\u4E0A\u699C\uFF0C\u4E89\u5F53\u7B2C\u4E00\uFF01</center></p>"),document.getElementById("lgef-flwing-rank-show").innerHTML=n}function s(t={},e=0){if(e===0&&(r.status?s({},1):h()),e===1&&f(l[g][0],{},s,e+1),e===2){t=JSON.parse(t.content);let n=[];for(let a=0;a<t.content.length;a++)for(let o=0;o<r.content.length;o++)`${t.content[a].uid}`==`${r.content[o].uid}`&&(n[n.length]=[a+1,r.content[o],t.content[a].count]);E(n)}}async function M(){$(),s()}function _(){i("Starting");let t=/^\/user\/[0-9]+/,e=/^\/$/;t.test(document.location.pathname)&&(i("User rank"),setInterval(u,1e3)),e.test(document.location.pathname)&&(i("Following rank"),M()),i("Started")}_();})();
